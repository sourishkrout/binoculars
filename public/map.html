<!DOCTYPE html>
<html>
	<header>
		<title>Binoculars</title>
		<script type="text/javascript" src="jquery-1.4.4.min.js"> </script>
		
		<script type="text/javascript" src="http://tripplanner.transit.511.org/mdv/mdvMap/mdvMap.js"> </script>
		<script type="text/javascript" src="http://tripplanner.transit.511.org/mdv/mdvMap/mdvMapPngTooltip.js"> </script>
		<script type="text/javascript" src="http://tripplanner.transit.511.org/mdv/mdvMap/mdvMapControlOak.js"> </script>
		<script type="text/javascript" src="http://tripplanner.transit.511.org/mdv/mdvMap/MDVMapScale.Oak.js"> </script>		
		
		<script type="text/javascript" src="http://204.94.80.214/maps/oak/script/new0/mdvMapSettings.js" type="text/javascript"> </script>
		<script type="text/javascript" src="http://204.94.80.214/maps/oak/script/new0/mdvMiniMapSettings.js" type="text/javascript"> </script>
		
		<script type="text/javascript">
			$(document).ready(function() {
				$('#map').each(function(idx) {
					startMap(this);
				});
			});
			
			var giurl = function(x, y) {
				var src = '/maps/oak/tiles/';
				var level = this.mdvMap.config.getZoomLevelIndex();
				var block   = this.getBlock();

				var columnMin = Math.floor((this.mdvMap.startTileWidth + x) / block) * block;
				var columnMax = columnMin + block-1;

				var rowMin    = Math.floor((this.mdvMap.startTileHeight + y) /block) * block;
				var rowMax    = rowMin + block - 1;

				src += 'zoomlevel';
				src += level;
				src += '/columns' + columnMin + '-' + columnMax; 
				src += '/column';
				src += (this.mdvMap.startTileWidth + x);
				src += '/rows' + rowMin + '-' + rowMax + '/';
				src += (this.mdvMap.startTileHeight + y);
				src += '_';
				src += (this.mdvMap.startTileWidth + x);
				src += '_';
				src += level;
				src += this.getFileType();
				
				return ('/tiles?tile=' + escape(src) + '&cz=' + level);
			};
			
			var map = null;
			var startMap = function(mapDiv) {
				map = new MDVMap(mapDiv);
				
				cfg = mdvMapConfig.clone();
				cfg.add('defaultScale', '0');
				cfg.add('serverURL', 'http://204.94.80.214/maps/oak/tiles/');
				cfg.add('transparentImg', 'transparent.gif');
				cfg.add('imagePath', '/');
				cfg.add('mapName', 'MTCV');
				cfg.add('network', 'OAK');
				cfg.add('tooltipHandler', 'onclick');
				cfg.add('useMagnifyGlass', 'true');
				cfg.add('zoomOnDoubleClick', 'true');
				cfg.add('xCenterReal', '562725');
				cfg.add('yCenterReal', '841665');
				cfg.add('block', '100');

				cfg.add('useToolTipScrollToFit', 'true');
				cfg.add('hotspotOnMouseWheel', 'true');
				
				var overlay0 = map.createOverlay('Binoculars', '', giurl);
				map.addOverlay(overlay0);

				map.events.registerEvent(MDVEvent_MAP_INITIALISED, this, function(id, msg, obj) {
					$('#xCoord').each(function(idx) {
						this.value = obj.getCentre().clone().x;
					});

					$('#yCoord').each(function(idx) {
						this.value = obj.getCentre().clone().y;
					});
				});

				new MDVMapNavigator(map);
				map.execute(cfg);

				$('#zoomin').each(function(idx) {
					$(this).click(function(e) { 
						var zl = map.config.getZoomLevelIndex(); 
						map.setZoomLevel(++zl); 
						map.update();
					});
				});
				$('#zoomout').each(function(idx) {
					$(this).click(function(e) { 
						var zl = map.config.getZoomLevelIndex(); 
						map.setZoomLevel(--zl); 
						map.update();
					});
				});
				$('#setCoord').each(function(idx) {
					$(this).click(function(e) {
						var c = new MDVCoordinates('MTCV', $('#xCoord').val(), $('#yCoord').val()); 
						map.setCentre(c);
						map.update();
					});
				});

			};
		</script>
		
	
	
	
	
	
		<style type="text/css">
			div#map {
				width: 800px;
				height: 700px;
				border: 1px solid black;
			}
			
			img {
				border: 0px solid red;
			}
			
		</style>
	</header>
	<body>
		<h1>Binoculars</h1>
		<h3>Visualize geo spatial map tile usage interactively using a heat map overlay.</h3>
		<div id="main">
			<div id="map">
			</div>
			<div id="controls">
				<p>
					X: <input type="text" id="xCoord" /> Y: <input type="text" id="yCoord" />
					<input type="button" id="setCoord" value="Set" />
				</p>
				<p>
					The brighter the green of the tile the more its been viewed by all public users. Darker red's the opposite. Use buttons below or mouse to pan and zoom the map view.
				</p>
				<p>
					Brought to you by node.js using canvas, redis and apache pig/hadoop. Find me at <a href="https://github.com/sourishkrout/">https://github.com/sourishkrout/</a>.
				</p>
				<input type="button" value="Zoom in" id="zoomin" />
				<input type="button" value="Zoom out" id="zoomout" />
			</div>
		</div>
	</body>
</html>
	
	
	
	
